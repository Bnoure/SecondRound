import t from"process";var i="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var e={};var n=t;(function(){var t={};var r=t.util={};var s=Array.prototype.concat;var o=Array.prototype.slice;r.bind=function bind(t,i){var e=o.call(arguments,2);return function(){t.apply(i,s.call(e,o.call(arguments)))}};r.extend=function extend(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};var a=t.SpringSystem=function SpringSystem(t){(this||i)._springRegistry={};(this||i)._activeSprings=[];(this||i).listeners=[];(this||i)._idleSpringIndices=[];(this||i).looper=t||new c;(this||i).looper.springSystem=this||i};r.extend(a.prototype,{_springRegistry:null,_isIdle:true,_lastTimeMillis:-1,_activeSprings:null,listeners:null,_idleSpringIndices:null,setLooper:function(t){(this||i).looper=t;t.springSystem=this||i},createSpring:function(t,i){var e;e=void 0===t||void 0===i?l.DEFAULT_ORIGAMI_SPRING_CONFIG:l.fromOrigamiTensionAndFriction(t,i);return this.createSpringWithConfig(e)},createSpringWithBouncinessAndSpeed:function(t,i){var e;e=void 0===t||void 0===i?l.DEFAULT_ORIGAMI_SPRING_CONFIG:l.fromBouncinessAndSpeed(t,i);return this.createSpringWithConfig(e)},createSpringWithConfig:function(t){var e=new u(this||i);this.registerSpring(e);e.setSpringConfig(t);return e},getIsIdle:function(){return(this||i)._isIdle},getSpringById:function(t){return(this||i)._springRegistry[t]},getAllSprings:function(){var t=[];for(var e in(this||i)._springRegistry)(this||i)._springRegistry.hasOwnProperty(e)&&t.push((this||i)._springRegistry[e]);return t},registerSpring:function(t){(this||i)._springRegistry[t.getId()]=t},deregisterSpring:function(t){removeFirst((this||i)._activeSprings,t);delete(this||i)._springRegistry[t.getId()]},advance:function(t,e){while((this||i)._idleSpringIndices.length>0)(this||i)._idleSpringIndices.pop();for(var n=0,r=(this||i)._activeSprings.length;n<r;n++){var s=(this||i)._activeSprings[n];s.systemShouldAdvance()?s.advance(t/1e3,e/1e3):(this||i)._idleSpringIndices.push((this||i)._activeSprings.indexOf(s))}while((this||i)._idleSpringIndices.length>0){var o=(this||i)._idleSpringIndices.pop();o>=0&&(this||i)._activeSprings.splice(o,1)}},loop:function(t){var e;-1===(this||i)._lastTimeMillis&&((this||i)._lastTimeMillis=t-1);var n=t-(this||i)._lastTimeMillis;(this||i)._lastTimeMillis=t;var r=0,s=(this||i).listeners.length;for(r=0;r<s;r++){e=(this||i).listeners[r];e.onBeforeIntegrate&&e.onBeforeIntegrate(this||i)}this.advance(t,n);if(0===(this||i)._activeSprings.length){(this||i)._isIdle=true;(this||i)._lastTimeMillis=-1}for(r=0;r<s;r++){e=(this||i).listeners[r];e.onAfterIntegrate&&e.onAfterIntegrate(this||i)}(this||i)._isIdle||(this||i).looper.run()},activateSpring:function(t){var e=(this||i)._springRegistry[t];-1==(this||i)._activeSprings.indexOf(e)&&(this||i)._activeSprings.push(e);if(this.getIsIdle()){(this||i)._isIdle=false;(this||i).looper.run()}},addListener:function(t){(this||i).listeners.push(t)},removeListener:function(t){removeFirst((this||i).listeners,t)},removeAllListeners:function(){(this||i).listeners=[]}});var u=t.Spring=function Spring(t){(this||i)._id="s"+Spring._ID++;(this||i)._springSystem=t;(this||i).listeners=[];(this||i)._currentState=new h;(this||i)._previousState=new h;(this||i)._tempState=new h};r.extend(u,{_ID:0,MAX_DELTA_TIME_SEC:.064,SOLVER_TIMESTEP_SEC:.001});r.extend(u.prototype,{_id:0,_springConfig:null,_overshootClampingEnabled:false,_currentState:null,_previousState:null,_tempState:null,_startValue:0,_endValue:0,_wasAtRest:true,_restSpeedThreshold:.001,_displacementFromRestThreshold:.001,listeners:null,_timeAccumulator:0,_springSystem:null,destroy:function(){(this||i).listeners=[];(this||i).frames=[];(this||i)._springSystem.deregisterSpring(this||i)},getId:function(){return(this||i)._id},setSpringConfig:function(t){(this||i)._springConfig=t;return this||i},getSpringConfig:function(){return(this||i)._springConfig},setCurrentValue:function(t,e){(this||i)._startValue=t;(this||i)._currentState.position=t;e||this.setAtRest();this.notifyPositionUpdated(false,false);return this||i},getStartValue:function(){return(this||i)._startValue},getCurrentValue:function(){return(this||i)._currentState.position},getCurrentDisplacementDistance:function(){return this.getDisplacementDistanceForState((this||i)._currentState)},getDisplacementDistanceForState:function(t){return Math.abs((this||i)._endValue-t.position)},setEndValue:function(t){if((this||i)._endValue==t&&this.isAtRest())return this||i;(this||i)._startValue=this.getCurrentValue();(this||i)._endValue=t;(this||i)._springSystem.activateSpring(this.getId());for(var e=0,n=(this||i).listeners.length;e<n;e++){var r=(this||i).listeners[e];var s=r.onSpringEndStateChange;s&&s(this||i)}return this||i},getEndValue:function(){return(this||i)._endValue},setVelocity:function(t){if(t===(this||i)._currentState.velocity)return this||i;(this||i)._currentState.velocity=t;(this||i)._springSystem.activateSpring(this.getId());return this||i},getVelocity:function(){return(this||i)._currentState.velocity},setRestSpeedThreshold:function(t){(this||i)._restSpeedThreshold=t;return this||i},getRestSpeedThreshold:function(){return(this||i)._restSpeedThreshold},setRestDisplacementThreshold:function(t){(this||i)._displacementFromRestThreshold=t},getRestDisplacementThreshold:function(){return(this||i)._displacementFromRestThreshold},setOvershootClampingEnabled:function(t){(this||i)._overshootClampingEnabled=t;return this||i},isOvershootClampingEnabled:function(){return(this||i)._overshootClampingEnabled},isOvershooting:function(){var t=(this||i)._startValue;var e=(this||i)._endValue;return(this||i)._springConfig.tension>0&&(t<e&&this.getCurrentValue()>e||t>e&&this.getCurrentValue()<e)},advance:function(t,e){var n=this.isAtRest();if(!n||!(this||i)._wasAtRest){var r=e;e>u.MAX_DELTA_TIME_SEC&&(r=u.MAX_DELTA_TIME_SEC);(this||i)._timeAccumulator+=r;var s=(this||i)._springConfig.tension,o=(this||i)._springConfig.friction,a=(this||i)._currentState.position,h=(this||i)._currentState.velocity,l=(this||i)._tempState.position,c=(this||i)._tempState.velocity,p,g,_,f,S,d,m,v,y,E;while((this||i)._timeAccumulator>=u.SOLVER_TIMESTEP_SEC){(this||i)._timeAccumulator-=u.SOLVER_TIMESTEP_SEC;if((this||i)._timeAccumulator<u.SOLVER_TIMESTEP_SEC){(this||i)._previousState.position=a;(this||i)._previousState.velocity=h}p=h;g=s*((this||i)._endValue-l)-o*h;l=a+p*u.SOLVER_TIMESTEP_SEC*.5;c=h+g*u.SOLVER_TIMESTEP_SEC*.5;_=c;f=s*((this||i)._endValue-l)-o*c;l=a+_*u.SOLVER_TIMESTEP_SEC*.5;c=h+f*u.SOLVER_TIMESTEP_SEC*.5;S=c;d=s*((this||i)._endValue-l)-o*c;l=a+S*u.SOLVER_TIMESTEP_SEC*.5;c=h+d*u.SOLVER_TIMESTEP_SEC*.5;m=c;v=s*((this||i)._endValue-l)-o*c;y=1/6*(p+2*(_+S)+m);E=1/6*(g+2*(f+d)+v);a+=y*u.SOLVER_TIMESTEP_SEC;h+=E*u.SOLVER_TIMESTEP_SEC}(this||i)._tempState.position=l;(this||i)._tempState.velocity=c;(this||i)._currentState.position=a;(this||i)._currentState.velocity=h;(this||i)._timeAccumulator>0&&this._interpolate((this||i)._timeAccumulator/u.SOLVER_TIMESTEP_SEC);if(this.isAtRest()||(this||i)._overshootClampingEnabled&&this.isOvershooting()){if((this||i)._springConfig.tension>0){(this||i)._startValue=(this||i)._endValue;(this||i)._currentState.position=(this||i)._endValue}else{(this||i)._endValue=(this||i)._currentState.position;(this||i)._startValue=(this||i)._endValue}this.setVelocity(0);n=true}var T=false;if((this||i)._wasAtRest){(this||i)._wasAtRest=false;T=true}var I=false;if(n){(this||i)._wasAtRest=true;I=true}this.notifyPositionUpdated(T,I)}},notifyPositionUpdated:function(t,e){for(var n=0,r=(this||i).listeners.length;n<r;n++){var s=(this||i).listeners[n];t&&s.onSpringActivate&&s.onSpringActivate(this||i);s.onSpringUpdate&&s.onSpringUpdate(this||i);e&&s.onSpringAtRest&&s.onSpringAtRest(this||i)}},systemShouldAdvance:function(){return!this.isAtRest()||!this.wasAtRest()},wasAtRest:function(){return(this||i)._wasAtRest},isAtRest:function(){return Math.abs((this||i)._currentState.velocity)<(this||i)._restSpeedThreshold&&(this.getDisplacementDistanceForState((this||i)._currentState)<=(this||i)._displacementFromRestThreshold||0===(this||i)._springConfig.tension)},setAtRest:function(){(this||i)._endValue=(this||i)._currentState.position;(this||i)._tempState.position=(this||i)._currentState.position;(this||i)._currentState.velocity=0;return this||i},_interpolate:function(t){(this||i)._currentState.position=(this||i)._currentState.position*t+(this||i)._previousState.position*(1-t);(this||i)._currentState.velocity=(this||i)._currentState.velocity*t+(this||i)._previousState.velocity*(1-t)},getListeners:function(){return(this||i).listeners},addListener:function(t){(this||i).listeners.push(t);return this||i},removeListener:function(t){removeFirst((this||i).listeners,t);return this||i},removeAllListeners:function(){(this||i).listeners=[];return this||i},currentValueIsApproximately:function(t){return Math.abs(this.getCurrentValue()-t)<=this.getRestDisplacementThreshold()}});var h=function PhysicsState(){};r.extend(h.prototype,{position:0,velocity:0});var l=t.SpringConfig=function SpringConfig(t,e){(this||i).tension=t;(this||i).friction=e};var c=t.AnimationLooper=function AnimationLooper(){(this||i).springSystem=null;var t=this||i;var _run=function(){t.springSystem.loop(Date.now())};(this||i).run=function(){r.onFrame(_run)}};t.SimulationLooper=function SimulationLooper(t){(this||i).springSystem=null;var e=0;var n=false;t=t||16.667;(this||i).run=function(){if(!n){n=true;while(!(this||i).springSystem.getIsIdle())(this||i).springSystem.loop(e+=t);n=false}}};t.SteppingSimulationLooper=function(t){(this||i).springSystem=null;var e=0;(this||i).run=function(){};(this||i).step=function(t){(this||i).springSystem.loop(e+=t)}};var p=t.OrigamiValueConverter={tensionFromOrigamiValue:function(t){return 3.62*(t-30)+194},origamiValueFromTension:function(t){return(t-194)/3.62+30},frictionFromOrigamiValue:function(t){return 3*(t-8)+25},origamiFromFriction:function(t){return(t-25)/3+8}};var g=t.BouncyConversion=function(t,e){(this||i).bounciness=t;(this||i).speed=e;var n=this.normalize(t/1.7,0,20);n=this.projectNormal(n,0,.8);var r=this.normalize(e/1.7,0,20);(this||i).bouncyTension=this.projectNormal(r,.5,200);(this||i).bouncyFriction=this.quadraticOutInterpolation(n,this.b3Nobounce((this||i).bouncyTension),.01)};r.extend(g.prototype,{normalize:function(t,i,e){return(t-i)/(e-i)},projectNormal:function(t,i,e){return i+t*(e-i)},linearInterpolation:function(t,i,e){return t*e+(1-t)*i},quadraticOutInterpolation:function(t,i,e){return this.linearInterpolation(2*t-t*t,i,e)},b3Friction1:function(t){return 7e-4*Math.pow(t,3)-.031*Math.pow(t,2)+.64*t+1.28},b3Friction2:function(t){return 44e-6*Math.pow(t,3)-.006*Math.pow(t,2)+.36*t+2},b3Friction3:function(t){return 45e-8*Math.pow(t,3)-332e-6*Math.pow(t,2)+.1078*t+5.84},b3Nobounce:function(t){var i=0;i=t<=18?this.b3Friction1(t):t>18&&t<=44?this.b3Friction2(t):this.b3Friction3(t);return i}});r.extend(l,{fromOrigamiTensionAndFriction:function(t,i){return new l(p.tensionFromOrigamiValue(t),p.frictionFromOrigamiValue(i))},fromBouncinessAndSpeed:function(i,e){var n=new t.BouncyConversion(i,e);return this.fromOrigamiTensionAndFriction(n.bouncyTension,n.bouncyFriction)},coastingConfigWithOrigamiFriction:function(t){return new l(0,p.frictionFromOrigamiValue(t))}});l.DEFAULT_ORIGAMI_SPRING_CONFIG=l.fromOrigamiTensionAndFriction(40,7);r.extend(l.prototype,{friction:0,tension:0});var _={};r.hexToRGB=function(t){if(_[t])return _[t];t=t.replace("#","");3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var i=t.match(/.{2}/g);var e={r:parseInt(i[0],16),g:parseInt(i[1],16),b:parseInt(i[2],16)};_[t]=e;return e};r.rgbToHex=function(t,i,e){t=t.toString(16);i=i.toString(16);e=e.toString(16);t=t.length<2?"0"+t:t;i=i.length<2?"0"+i:i;e=e.length<2?"0"+e:e;return"#"+t+i+e};var f=t.MathUtil={mapValueInRange:function(t,i,e,n,r){var s=e-i;var o=r-n;var a=(t-i)/s;return n+a*o},interpolateColor:function(t,i,e,n,s,o){n=void 0===n?0:n;s=void 0===s?1:s;i=r.hexToRGB(i);e=r.hexToRGB(e);var a=Math.floor(r.mapValueInRange(t,n,s,i.r,e.r));var u=Math.floor(r.mapValueInRange(t,n,s,i.g,e.g));var h=Math.floor(r.mapValueInRange(t,n,s,i.b,e.b));return o?"rgb("+a+","+u+","+h+")":r.rgbToHex(a,u,h)},degreesToRadians:function(t){return t*Math.PI/180},radiansToDegrees:function(t){return 180*t/Math.PI}};r.extend(r,f);function removeFirst(t,i){var e=t.indexOf(i);-1!=e&&t.splice(e,1)}var S;"undefined"!==typeof window&&(S=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)});S||"undefined"===typeof n||"node"!==n.title||(S=n.nextTick);r.onFrame=function onFrame(t){return S(t)};r.extend(e,t)})();export default e;

