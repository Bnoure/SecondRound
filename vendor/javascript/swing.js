import t from"lodash";import e from"sister";import r from"hammerjs";import a from"rebound";import n from"vendor-prefix";import o from"raf";var i={};Object.defineProperty(i,"__esModule",{value:true});var d={DOWN:Symbol("DOWN"),INVALID:Symbol("INVALID"),LEFT:Symbol("LEFT"),RIGHT:Symbol("RIGHT"),UP:Symbol("UP")};i.default=d;i=i["default"];var u=i;var f={};Object.defineProperty(f,"__esModule",{value:true});f.isTouchDevice=f.elementChildren=void 0;var v=t;var l=_interopRequireDefault(v);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var c=function elementChildren(t){return l.default.filter(t.childNodes,{nodeType:1})};var s=function isTouchDevice(){return"ontouchstart"in window||navigator.msMaxTouchPoints};f.elementChildren=c;f.isTouchDevice=s;var h="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var p={};Object.defineProperty(p,"__esModule",{value:true});var g=t;var m=_interopRequireDefault$1(g);var w=e;var D=_interopRequireDefault$1(w);var T=r;var R=_interopRequireDefault$1(T);var _=a;var C=_interopRequireDefault$1(_);var O=n;var S=_interopRequireDefault$1(O);var M=o;var y=_interopRequireDefault$1(M);var I=u;var P=_interopRequireDefault$1(I);var b=f;function _interopRequireDefault$1(t){return t&&t.__esModule?t:{default:t}}var q=function computeDirection(t,e,r){var a=Math.abs(t)>Math.abs(e);var n=t<0?P.default.LEFT:P.default.RIGHT;var o=e<0?P.default.UP:P.default.DOWN;var i=a?n:o;return-1===r.indexOf(i)?P.default.INVALID:i};var L=function Card(t,e,r){var a=void 0;var n=void 0;var o=void 0;var i=void 0;var d=void 0;var u=void 0;var f=void 0;var v=void 0;var l=void 0;var c=void 0;var s=void 0;var p=void 0;var g=void 0;var m=void 0;var w=void 0;var T=void 0;var _=void 0;var O=void 0;var S=void 0;var M=void 0;var I=void 0;var L=function construct(){a={};n=Card.makeConfig(t.getConfig());u=(0,D.default)();w=t.getSpringSystem();T=w.createSpring(250,10);_=w.createSpring(500,20);l={};c={coordinateX:0,coordinateY:0};O={};O[P.default.LEFT]="throwoutleft";O[P.default.RIGHT]="throwoutright";O[P.default.UP]="throwoutup";O[P.default.DOWN]="throwoutdown";T.setRestSpeedThreshold(.05);T.setRestDisplacementThreshold(.05);_.setRestSpeedThreshold(.05);_.setRestDisplacementThreshold(.05);S=n.throwOutDistance(n.minThrowOutDistance,n.maxThrowOutDistance);g=new R.default.Manager(e,{recognizers:[[R.default.Pan,{threshold:2}]]});r?Card.prependToParent(e):Card.appendToParent(e);u.on("panstart",(function(){Card.appendToParent(e);u.trigger("dragstart",{target:e});o=0;i=0;f=true;(function animation(){if(f){d();(0,y.default)(animation)}})()}));u.on("panmove",(function(t){o=t.deltaX;i=t.deltaY}));u.on("panend",(function(t){f=false;var r=c.coordinateX+t.deltaX;var o=c.coordinateY+t.deltaY;var i=n.isThrowOut(r,o,e,n.throwOutConfidence(r,o,e));var d=q(r,o,n.allowedDirections);i&&d!==P.default.INVALID?a.throwOut(r,o,d):a.throwIn(r,o,d);u.trigger("dragend",{target:e})}));if((0,b.isTouchDevice)()){e.addEventListener("touchstart",(function(){u.trigger("panstart")}));e.addEventListener("touchend",(function(){f&&!v&&u.trigger("dragend",{target:e})}));(function(){var t=void 0;e.addEventListener("touchstart",(function(){t=true}));e.addEventListener("touchend",(function(){t=false}));h.addEventListener("touchmove",(function(e){t&&e.preventDefault()}))})()}else{e.addEventListener("mousedown",(function(){I=Card.appendToParent(e)||I;u.trigger("panstart")}));e.addEventListener("mouseup",(function(){if(I){e.click();I=false}f&&!v&&u.trigger("dragend",{target:e})}))}g.on("panstart",(function(t){v=true;u.trigger("panstart",t)}));g.on("panmove",(function(t){u.trigger("panmove",t)}));g.on("panend",(function(t){v=false;u.trigger("panend",t)}));T.addListener({onSpringAtRest:function onSpringAtRest(){u.trigger("throwinend",{target:e})},onSpringUpdate:function onSpringUpdate(t){var e=t.getCurrentValue();var r=C.default.MathUtil.mapValueInRange(e,0,1,l.fromX,0);var a=C.default.MathUtil.mapValueInRange(e,0,1,l.fromY,0);m(r,a)}});_.addListener({onSpringAtRest:function onSpringAtRest(){u.trigger("throwoutend",{target:e})},onSpringUpdate:function onSpringUpdate(t){var e=t.getCurrentValue();var r=void 0;var a=void 0;var n=void 0;if(l.direction===P.default.RIGHT||l.direction===P.default.LEFT){n=l.direction===P.default.RIGHT?1:-1;r=C.default.MathUtil.mapValueInRange(e,0,1,l.fromX,S*n);a=l.fromY}else if(l.direction===P.default.UP||l.direction===P.default.DOWN){n=l.direction===P.default.DOWN?1:-1;r=l.fromX;a=C.default.MathUtil.mapValueInRange(e,0,1,l.fromY,S*n)}m(r,a)}});d=function doMove(){if(o!==s||i!==p){s=o;p=i;var t=c.coordinateX+o;var r=c.coordinateY+i;var a=n.rotation(t,r,e,n.maxRotation);n.transform(e,t,r,a);u.trigger("dragmove",{offset:t,target:e,throwDirection:q(t,r,n.allowedDirections),throwOutConfidence:n.throwOutConfidence(t,r,e)})}};m=function _onSpringUpdate(t,r){var a=n.rotation(t,r,e,n.maxRotation);c.coordinateX=t||0;c.coordinateY=r||0;n.transform(e,t,r,a)};M=function throwWhere(t,r,a,o){l.fromX=r;l.fromY=a;l.direction=o||q(r,a,n.allowedDirections);if(t===Card.THROW_IN){Card.appendToParent(e);T.setCurrentValue(0).setAtRest().setEndValue(1);u.trigger("throwin",{target:e,throwDirection:l.direction})}else{if(t!==Card.THROW_OUT)throw new Error("Invalid throw event.");Card.appendToParent(e);_.setCurrentValue(0).setAtRest().setVelocity(100).setEndValue(1);u.trigger("throwout",{target:e,throwDirection:l.direction});u.trigger(O[l.direction],{target:e,throwDirection:l.direction})}}};L();a.on=u.on;a.trigger=u.trigger;a.throwIn=function(t,e,r){M(Card.THROW_IN,t,e,r)};a.throwOut=function(t,e,r){M(Card.THROW_OUT,t,e,r)};a.destroy=function(){g.destroy();T.destroy();_.destroy();t.destroyCard(a)};return a};L.makeConfig=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e={allowedDirections:[P.default.RIGHT,P.default.LEFT,P.default.UP],isThrowOut:L.isThrowOut,maxRotation:20,maxThrowOutDistance:500,minThrowOutDistance:400,rotation:L.rotation,throwOutConfidence:L.throwOutConfidence,throwOutDistance:L.throwOutDistance,transform:L.transform};return m.default.assign({},e,t)};L.transform=function(t,e,r,a){t.style[(0,S.default)("transform")]="translate3d(0, 0, 0) translate("+e+"px, "+r+"px) rotate("+a+"deg)"};L.appendToParent=function(t){var e=t.parentNode;var r=(0,b.elementChildren)(e);var a=r.indexOf(t);var n=a+1!==r.length;if(n){e.removeChild(t);e.appendChild(t)}return n};L.prependToParent=function(t){var e=t.parentNode;e.removeChild(t);e.insertBefore(t,e.firstChild)};L.throwOutConfidence=function(t,e,r){var a=Math.min(Math.abs(t)/r.offsetWidth,1);var n=Math.min(Math.abs(e)/r.offsetHeight,1);return Math.max(a,n)};L.isThrowOut=function(t,e,r,a){return 1===a};L.throwOutDistance=function(t,e){return m.default.random(t,e)};L.rotation=function(t,e,r,a){var n=Math.min(Math.max(t/r.offsetWidth,-1),1);var o=(e>0?1:-1)*Math.min(Math.abs(e)/100,1);var i=n*o*a;return i};L.THROW_IN="in";L.THROW_OUT="out";p.default=L;p=p["default"];var U=p;var E={};Object.defineProperty(E,"__esModule",{value:true});var $=t;var N=_interopRequireDefault$2($);var x=e;var V=_interopRequireDefault$2(x);var W=a;var H=_interopRequireDefault$2(W);var A=U;var X=_interopRequireDefault$2(A);function _interopRequireDefault$2(t){return t&&t.__esModule?t:{default:t}}var Y=function Stack(t){var e=void 0;var r=void 0;var a=void 0;var n=void 0;var o=function construct(){n={};a=new H.default.SpringSystem;e=(0,V.default)();r=[]};o();n.getConfig=function(){return t};n.getSpringSystem=function(){return a};n.on=function(t,r){e.on(t,r)};n.createCard=function(t,a){var o=(0,X.default)(n,t,a);var i=["throwout","throwoutend","throwoutleft","throwoutright","throwoutup","throwoutdown","throwin","throwinend","dragstart","dragmove","dragend"];i.forEach((function(t){o.on(t,(function(r){e.trigger(t,r)}))}));r.push({card:o,element:t});return o};n.getCard=function(t){var e=N.default.find(r,{element:t});return e?e.card:null};n.destroyCard=function(t){e.trigger("destroyCard",t);return N.default.remove(r,{card:t})};return n};E.default=Y;E=E["default"];var k=E;var G={};Object.defineProperty(G,"__esModule",{value:true});G.Stack=G.Direction=G.Card=void 0;var j=U;var F=_interopRequireDefault$3(j);var z=u;var B=_interopRequireDefault$3(z);var J=k;var K=_interopRequireDefault$3(J);function _interopRequireDefault$3(t){return t&&t.__esModule?t:{default:t}}G.Card=F.default;G.Direction=B.default;G.Stack=K.default;const Q=G.__esModule,Z=G.Stack,tt=G.Direction,et=G.Card;export default G;export{et as Card,tt as Direction,Z as Stack,Q as __esModule};

